<link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v0.14.0/mapbox-gl-draw.css' type='text/css' />
<script src="<%= javascript_path('bundle.js') %>"></script>
<div class="spinner-container spinner"></div>
<div id="panel">
  <div class="panel-header o-grid__cell o-grid__cell--width-100">
    <div class="panel-header-title">
      <h3 class="c-heading">
        <%= @city.name %>
      </h3>
      <a class="c-link" href="/<%= @city.url_name %>">Volver</a>
    </div>
    <span class="c-input-group">
      <button id="edit-elements" class="c-button c-button--active c-button--info" type="button">Editar elementos</button>
      <button id="edit-lines" class="c-button c-button--info" type="button">Editar líneas</button>
    </span>
  </div>
  <div class="panel-body">
    <div class="editor-cards-container">
      <div class="c-card">
        <div class="c-card__item">
          <b><p id="feature-header" class="c-paragraph">Ningún elemento seleccionado</p></b>
          <p id="feature-properties" class="c-paragraph"></p>
        </div>
      </div>
      <div class="c-card">
        <div class="c-card__item">
          <b><p id="modifications-header" class="c-paragraph">Ningún elemento modificado</p></b>
          <p id="modifications" class="c-paragraph"></p>
        </div>
      </div>
      <div id="edit-lines-card" class="c-card">
        <div class="c-card__item">
          <p class="c-paragraph">...</p>
        </div>
      </div>
    </div>
  </div>
</div>
<main class="o-grid__cell o-grid__cell--width-100 o-panel-container">
  <div id="map"></div>
</main>

<script>
  window.onload = function() {
    var config = <%= @config.to_json %>;
    var mapboxAccessToken = <%= MAPBOX_ACCESS_TOKEN.to_json %>;
    var mapboxStyle = <%= MAPBOX_STYLE.to_json %>;

    var sections = <%= lines_features_collection(@city, 'sections').to_json %>;
    var stations = <%= lines_features_collection(@city, 'stations').to_json %>;
    var lines = <%= @lines.to_json %>;
    var style = <%= @city.style.to_json %>;
    loadEditor(style, lines, sections, stations, config, mapboxAccessToken, mapboxStyle);
  }
</script>
